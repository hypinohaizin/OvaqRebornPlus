package net.shoreline.client.impl.module.exploit;

import net.minecraft.util.math.*;
import net.shoreline.client.api.event.EventStage;
import net.shoreline.client.api.event.listener.EventListener;
import net.shoreline.client.api.module.ModuleCategory;
import net.shoreline.client.api.module.ToggleModule;
import net.shoreline.client.impl.event.TickEvent;

/**
 * @author linus
 * @since 1.0
 */
public class HitboxDesyncModule extends ToggleModule {

    private static final double MAGIC_OFFSET = 0.20000996883537;

    public HitboxDesyncModule() {
        super("HitboxDesync", "Pasted code", ModuleCategory.EXPLOIT);
    }

    @Override
    public void onEnable() {
        super.onEnable();
    }

    @Override
    public void onDisable() {
        super.onDisable();
    }

    @EventListener
    public void onGameTick(TickEvent event) {
        if (event.getStage() == EventStage.POST) {
            Direction facing = mc.player.getHorizontalFacing();
            Box boundingBox = mc.player.getBoundingBox();
            Vec3d center = boundingBox.getCenter();
            Vec3d offset = new Vec3d(facing.getUnitVector());

            Vec3d finalPosition = merge(Vec3d.of(BlockPos.ofFloored(center)).add(0.5, 0, 0.5).add(offset.multiply(MAGIC_OFFSET)), facing);
            mc.player.setPosition(finalPosition.x == 0 ? mc.player.getX() : finalPosition.x, mc.player.getY(), finalPosition.z == 0 ? mc.player.getZ() : finalPosition.z);
            toggle();
        }
    }

    private Vec3d merge(Vec3d position, Direction facing) {
        return new Vec3d(
                position.x * Math.abs(facing.getUnitVector().x),
                position.y * Math.abs(facing.getUnitVector().y),
                position.z * Math.abs(facing.getUnitVector().z)
        );
    }
}
